[gd_scene load_steps=47 format=3 uid="uid://lu41kh8ew3kp"]

[ext_resource type="Script" path="res://Track/Track.cs" id="1_6biqv"]
[ext_resource type="Script" path="res://GameManager.cs" id="1_t6yb8"]
[ext_resource type="Script" path="res://Track/SwitchData.cs" id="3_0qj0l"]
[ext_resource type="Texture2D" uid="uid://cebuwa8t40kgt" path="res://Track/Track.png" id="3_lm75x"]
[ext_resource type="Script" path="res://Track/DrawCurve.cs" id="4_av70w"]
[ext_resource type="Texture2D" uid="uid://72gf582c2d4f" path="res://FinishLine.png" id="4_me0gi"]
[ext_resource type="PackedScene" uid="uid://5lb0t482wq50" path="res://Trains/Train.tscn" id="5_qyn6a"]
[ext_resource type="PackedScene" uid="uid://dt30uhagjuvx2" path="res://Trains/EnemyTrain.tscn" id="6_5rgaw"]
[ext_resource type="Script" path="res://FollowObject.cs" id="6_hro7i"]
[ext_resource type="Script" path="res://Trains/Cannons/Cannon.cs" id="6_iwbo0"]
[ext_resource type="PackedScene" uid="uid://cjcxa1f5rvwu7" path="res://Projectiles/Projectile.tscn" id="6_ywxqh"]
[ext_resource type="Script" path="res://Trains/InputControllers/BasicAIInputController.cs" id="8_oysgh"]
[ext_resource type="Script" path="res://Targets/TargetHolder.cs" id="8_u6cwp"]
[ext_resource type="PackedScene" uid="uid://bvm72leplh7wi" path="res://Targets/TargetBalloon.tscn" id="9_ekc8f"]

[sub_resource type="Curve2D" id="Curve2D_ig2ux"]
_data = {
"points": PackedVector2Array(-2.57598, 84.4653, 2.57598, -84.4653, -4, 143, -94.9959, -32.344, 94.9959, 32.344, 192, 66, -82, 25.5, 82, -25.5, 294, -69, 0.5, -68, -0.5, 68, 504, 144, 52.5, -11.5, -52.5, 11.5, 352, 266, 61.2246, -7.85723, -61.2246, 7.85723, 175, 193, -2.48704, 134.411, 2.48704, -134.411, -4, 143)
}
point_count = 7

[sub_resource type="Resource" id="Resource_ked8j"]
script = ExtResource("3_0qj0l")
track = NodePath(".")
distance = 1410.0
direction = 3
isFinishLine = false

[sub_resource type="Resource" id="Resource_vog2j"]
script = ExtResource("3_0qj0l")
track = NodePath(".")
distance = 0.0
direction = 3
isFinishLine = true

[sub_resource type="Resource" id="Resource_184qh"]
resource_local_to_scene = true
script = ExtResource("6_iwbo0")
projectile = ExtResource("6_ywxqh")
maxStoredShots = 1
rechargeTime = 3.0
shotCooldownTime = 0.5
shotSpeed = 200.0
trainSpdMult = 0.33

[sub_resource type="Resource" id="Resource_l3a3m"]
resource_local_to_scene = true
script = ExtResource("8_oysgh")

[sub_resource type="Resource" id="Resource_1agnl"]
resource_local_to_scene = true
script = ExtResource("6_iwbo0")
projectile = ExtResource("6_ywxqh")
maxStoredShots = 1
rechargeTime = 3.0
shotCooldownTime = 0.5
shotSpeed = 200.0
trainSpdMult = 0.33

[sub_resource type="Resource" id="Resource_wcj4g"]
resource_local_to_scene = true
script = ExtResource("8_oysgh")

[sub_resource type="Resource" id="Resource_ujv61"]
resource_local_to_scene = true
script = ExtResource("6_iwbo0")
projectile = ExtResource("6_ywxqh")
maxStoredShots = 1
rechargeTime = 3.0
shotCooldownTime = 0.5
shotSpeed = 200.0
trainSpdMult = 0.33

[sub_resource type="Resource" id="Resource_iyd5c"]
resource_local_to_scene = true
script = ExtResource("8_oysgh")

[sub_resource type="Resource" id="Resource_rb7p5"]
resource_local_to_scene = true
script = ExtResource("6_iwbo0")
projectile = ExtResource("6_ywxqh")
maxStoredShots = 1
rechargeTime = 3.0
shotCooldownTime = 0.5
shotSpeed = 200.0
trainSpdMult = 0.33

[sub_resource type="Curve2D" id="Curve2D_63une"]
_data = {
"points": PackedVector2Array(-31.4449, 12.2953, 31.4449, -12.2953, -54, -179, -30.6822, 27.1818, 30.6822, -27.1818, 71, -259, -85.627, 10.0649, 85.627, -10.0649, 203, -314)
}
point_count = 3

[sub_resource type="Resource" id="Resource_wqm0h"]
script = ExtResource("3_0qj0l")
track = NodePath("../MainTrack")
distance = 101.0
direction = 1
isFinishLine = false

[sub_resource type="Resource" id="Resource_lggti"]
script = ExtResource("3_0qj0l")
track = NodePath("../MainTrack")
distance = 460.0
direction = 1
isFinishLine = false

[sub_resource type="Curve2D" id="Curve2D_03fm8"]
_data = {
"points": PackedVector2Array(-7.34822, 111.419, 7.34822, -111.419, 249, 11, 142.545, -28.3733, -142.545, 28.3733, 374, 104, 34, -35.5, -34, 35.5, 453, 223)
}
point_count = 3

[sub_resource type="Resource" id="Resource_ayjyu"]
script = ExtResource("3_0qj0l")
track = NodePath("../MainTrack")
distance = 347.0
direction = 2
isFinishLine = false

[sub_resource type="Resource" id="Resource_8u633"]
script = ExtResource("3_0qj0l")
track = NodePath("../MainTrack")
distance = 868.0
direction = 2
isFinishLine = false

[sub_resource type="Curve2D" id="Curve2D_afrti"]
_data = {
"points": PackedVector2Array(109, -12, -109, 12, 346, 267, 55.2348, 6.30615, -55.2348, -6.30615, 170, 276, 35.5, 22.5, -35.5, -22.5, 24, 216)
}
point_count = 3

[sub_resource type="Resource" id="Resource_d3thg"]
script = ExtResource("3_0qj0l")
track = NodePath("../MainTrack")
distance = 983.0
direction = 1
isFinishLine = false

[sub_resource type="Resource" id="Resource_qnhbm"]
script = ExtResource("3_0qj0l")
track = NodePath("../MainTrack")
distance = 1330.0
direction = 1
isFinishLine = false

[sub_resource type="LabelSettings" id="LabelSettings_4a7tb"]
font_size = 48

[sub_resource type="LabelSettings" id="LabelSettings_fhswm"]
font_size = 24

[sub_resource type="LabelSettings" id="LabelSettings_1q31c"]
font_size = 98
font_color = Color(0.721569, 1, 1, 1)

[sub_resource type="Animation" id="Animation_445n2"]
resource_name = "PlayStartCountdown"
length = 4.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:text")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1, 2, 3),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": ["3", "2", "1", "Go!"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:scale")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.9, 1, 1.9, 2, 2.9, 3, 4),
"transitions": PackedFloat32Array(1, 1000, 1, 1000, 1, 1000, 1, 1000),
"update": 0,
"values": [Vector2(2, 2), Vector2(1, 1), Vector2(2, 2), Vector2(1, 1), Vector2(2, 2), Vector2(1, 1), Vector2(2, 2), Vector2(1, 1)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath(".:modulate")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.9, 1, 1.9, 2, 2.9, 3, 4),
"transitions": PackedFloat32Array(1, 1000, 1, 1000, 1, 1000, 1, 1000),
"update": 0,
"values": [Color(1, 1, 1, 1), Color(1, 1, 1, 0), Color(1, 1, 1, 1), Color(1, 1, 1, 0), Color(1, 1, 1, 1), Color(1, 1, 1, 0), Color(1, 1, 1, 1), Color(1, 1, 1, 0)]
}
tracks/3/type = "method"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("../../..")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(2.9),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"StartRace"
}]
}

[sub_resource type="Animation" id="Animation_d8esa"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 1)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:scale")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(2, 2)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_4h26i"]
_data = {
"PlayStartCountdown": SubResource("Animation_445n2"),
"RESET": SubResource("Animation_d8esa")
}

[sub_resource type="LabelSettings" id="LabelSettings_6t1fd"]
font_size = 98

[sub_resource type="LabelSettings" id="LabelSettings_kwct4"]
font_size = 32

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_1rbkp"]
bg_color = Color(0.137255, 0.137255, 0.443137, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_1g11k"]
bg_color = Color(0.34902, 0.137255, 0.101961, 1)

[sub_resource type="Animation" id="Animation_jslub"]
resource_name = "GameOverScreenAppear"
length = 2.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Content:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1.8, 2),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector2(0, 50), Vector2(0, -10), Vector2(0, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:modulate")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 2),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Color(1, 1, 1, 0), Color(1, 1, 1, 1)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath(".:visible")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_w05v6"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Content:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:modulate")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 1)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_kbmt4"]
_data = {
"GameOverScreenAppear": SubResource("Animation_jslub"),
"RESET": SubResource("Animation_w05v6")
}

[node name="RaceScene" type="Node2D" node_paths=PackedStringArray("racePositionText", "lapCounter", "startCountdown", "gameOverScreen")]
script = ExtResource("1_t6yb8")
racePositionText = NodePath("UI/Screen/Position")
lapCounter = NodePath("UI/Screen/LapCounter")
startCountdown = NodePath("UI/Screen/StartCountdown")
gameOverScreen = NodePath("UI/GameOverScreen")

[node name="Track-Meadows" type="Node2D" parent="."]
position = Vector2(227, 107)

[node name="MainTrack" type="Path2D" parent="Track-Meadows"]
curve = SubResource("Curve2D_ig2ux")
script = ExtResource("1_6biqv")
entryData = SubResource("Resource_ked8j")
exitData = SubResource("Resource_vog2j")

[node name="FinishLine" type="Sprite2D" parent="Track-Meadows/MainTrack"]
z_index = 2
position = Vector2(-4, 144)
rotation = 0.0581094
texture = ExtResource("4_me0gi")

[node name="Image" type="Line2D" parent="Track-Meadows/MainTrack"]
texture = ExtResource("3_lm75x")
texture_mode = 1
script = ExtResource("4_av70w")

[node name="Train" parent="Track-Meadows/MainTrack" instance=ExtResource("5_qyn6a")]
position = Vector2(-4, 143)
rotation = -1.54031
cannon = SubResource("Resource_184qh")
metadata/_edit_lock_ = true

[node name="EnemyTrain" parent="Track-Meadows/MainTrack" instance=ExtResource("6_5rgaw")]
position = Vector2(36.8865, 71.2095)
rotation = -0.551916
progress = 86.3474
controller = SubResource("Resource_l3a3m")
cannon = SubResource("Resource_1agnl")
metadata/_edit_lock_ = true

[node name="EnemyTrain2" parent="Track-Meadows/MainTrack" instance=ExtResource("6_5rgaw")]
position = Vector2(132.398, 53.1962)
rotation = 0.0879084
progress = 185.167
controller = SubResource("Resource_wcj4g")
cannon = SubResource("Resource_ujv61")
metadata/_edit_lock_ = true

[node name="EnemyTrain3" parent="Track-Meadows/MainTrack" instance=ExtResource("6_5rgaw")]
position = Vector2(216.827, 70.7606)
rotation = -0.0207002
progress = 271.652
controller = SubResource("Resource_iyd5c")
cannon = SubResource("Resource_rb7p5")
metadata/_edit_lock_ = true

[node name="PathFollow2D" type="PathFollow2D" parent="Track-Meadows/MainTrack"]
editor_description = "A dummy PathFollow2D that we can use to find exact distances in the editor. Can freely delete."
position = Vector2(346.09, 266.863)
rotation = 3.06555
progress = 983.0

[node name="Shortcut1" type="Path2D" parent="Track-Meadows"]
position = Vector2(104, 243)
curve = SubResource("Curve2D_63une")
script = ExtResource("1_6biqv")
entryData = SubResource("Resource_wqm0h")
exitData = SubResource("Resource_lggti")

[node name="Image" type="Line2D" parent="Track-Meadows/Shortcut1"]
texture = ExtResource("3_lm75x")
texture_mode = 1
script = ExtResource("4_av70w")

[node name="Shortcut2" type="Path2D" parent="Track-Meadows"]
curve = SubResource("Curve2D_03fm8")
script = ExtResource("1_6biqv")
entryData = SubResource("Resource_ayjyu")
exitData = SubResource("Resource_8u633")

[node name="Image" type="Line2D" parent="Track-Meadows/Shortcut2"]
texture = ExtResource("3_lm75x")
texture_mode = 1
script = ExtResource("4_av70w")

[node name="Shortcut3" type="Path2D" parent="Track-Meadows"]
curve = SubResource("Curve2D_afrti")
script = ExtResource("1_6biqv")
entryData = SubResource("Resource_d3thg")
exitData = SubResource("Resource_qnhbm")

[node name="Image" type="Line2D" parent="Track-Meadows/Shortcut3"]
texture = ExtResource("3_lm75x")
texture_mode = 1
script = ExtResource("4_av70w")

[node name="ProjectileHolder" type="Node2D" parent="."]

[node name="TargetHolder" type="Control" parent="."]
layout_mode = 3
anchors_preset = 0
offset_left = 150.0
offset_right = 800.0
offset_bottom = 450.0
script = ExtResource("8_u6cwp")
boostTarget = ExtResource("9_ekc8f")
metadata/_edit_lock_ = true

[node name="Timer" type="Timer" parent="TargetHolder"]
wait_time = 3.0
autostart = true

[node name="Camera" type="Node2D" parent="." node_paths=PackedStringArray("target")]
position = Vector2(227, 107)
script = ExtResource("6_hro7i")
target = NodePath("../Track-Meadows/MainTrack/Train")

[node name="Camera2D" type="Camera2D" parent="Camera"]
position = Vector2(0, -50)
zoom = Vector2(2.5, 2.5)
position_smoothing_enabled = true
rotation_smoothing_enabled = true

[node name="UI" type="CanvasLayer" parent="."]

[node name="Screen" type="Control" parent="UI"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
metadata/_edit_lock_ = true

[node name="Position" type="Label" parent="UI/Screen"]
layout_mode = 0
offset_left = 9.0
offset_top = 4.0
offset_right = 90.0
offset_bottom = 74.0
text = "4th"
label_settings = SubResource("LabelSettings_4a7tb")
horizontal_alignment = 1
vertical_alignment = 1

[node name="LapCounter" type="Label" parent="UI/Screen"]
layout_mode = 0
offset_left = 10.0
offset_top = 63.0
offset_right = 95.0
offset_bottom = 101.0
text = "Lap 1/3"
label_settings = SubResource("LabelSettings_fhswm")
horizontal_alignment = 1
vertical_alignment = 1

[node name="StartCountdown" type="Label" parent="UI/Screen"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -79.0
offset_top = -68.5
offset_right = 79.0
offset_bottom = 68.5
grow_horizontal = 2
grow_vertical = 2
scale = Vector2(2, 2)
pivot_offset = Vector2(80, 69)
text = "Go!"
label_settings = SubResource("LabelSettings_1q31c")
horizontal_alignment = 1
vertical_alignment = 1

[node name="AnimationPlayer" type="AnimationPlayer" parent="UI/Screen/StartCountdown"]
libraries = {
"": SubResource("AnimationLibrary_4h26i")
}

[node name="GameOverScreen" type="ColorRect" parent="UI"]
visible = false
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0.588235)

[node name="Content" type="Control" parent="UI/GameOverScreen"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="Label" type="Label" parent="UI/GameOverScreen/Content"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -264.0
offset_top = -166.0
offset_right = 266.0
offset_bottom = -29.0
grow_horizontal = 2
grow_vertical = 2
text = "Game Over"
label_settings = SubResource("LabelSettings_6t1fd")

[node name="Label2" type="Label" parent="UI/GameOverScreen/Content"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -263.0
offset_top = -55.0
offset_right = 267.0
offset_bottom = -2.0
grow_horizontal = 2
grow_vertical = 2
text = "Your train was destroyed..."
label_settings = SubResource("LabelSettings_kwct4")
horizontal_alignment = 1
vertical_alignment = 1

[node name="Button" type="Button" parent="UI/GameOverScreen/Content"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -150.0
offset_top = 22.0
offset_right = 150.0
offset_bottom = 102.0
grow_horizontal = 2
grow_vertical = 2
theme_override_font_sizes/font_size = 48
theme_override_styles/normal = SubResource("StyleBoxFlat_1rbkp")
text = "Retry"

[node name="Button2" type="Button" parent="UI/GameOverScreen/Content"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -150.0
offset_top = 127.0
offset_right = 150.0
offset_bottom = 207.0
grow_horizontal = 2
grow_vertical = 2
theme_override_font_sizes/font_size = 48
theme_override_styles/normal = SubResource("StyleBoxFlat_1g11k")
text = "Title Screen"

[node name="AnimationPlayer" type="AnimationPlayer" parent="UI/GameOverScreen"]
libraries = {
"": SubResource("AnimationLibrary_kbmt4")
}

[node name="PositionUpdateTimer" type="Timer" parent="."]
wait_time = 0.5
autostart = true

[connection signal="timeout" from="TargetHolder/Timer" to="TargetHolder" method="OnTimerTimeout"]
[connection signal="timeout" from="PositionUpdateTimer" to="." method="UpdatePositions"]
